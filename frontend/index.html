<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conecta Barrio - Registro</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>Conecta Barrio</h1>
            <p class="subtitle">Registro de Perfil para Comercios y Profesionales</p>
        </header>
        
        <div class="progress-bar">
            <div class="progress-step step-active">
                <div class="step-number">1</div>
                <div class="step-text">Registro</div>
            </div>
            <div class="progress-step">
                <div class="step-number">2</div>
                <div class="step-text">Perfil</div>
            </div>
            <div class="progress-step">
                <div class="step-number">3</div>
                <div class="step-text">Completado</div>
            </div>
        </div>
        
        <div id="registerForm">
            <form id="registrationForm">
                <div class="form-group">
                    <label for="profileType">Tipo de Perfil *</label>
                    <select id="profileType" required>
                        <option value="">Seleccione un tipo de perfil</option>
                        <option value="comerciante">Comerciante/Profesional</option>
                        <option value="vecino">Vecino</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="fullName">Nombre y Apellido *</label>
                    <input type="text" id="fullName" required placeholder="Ingrese su nombre completo">
                </div>
                
                <div class="form-group">
                    <label for="email">Email *</label>
                    <input type="email" id="email" required placeholder="ejemplo@correo.com">
                    <div id="emailError" class="error hidden">Este email ya está registrado</div>
                </div>
                
                <div class="form-group">
                    <label for="password">Contraseña *</label>
                    <input type="password" id="password" required placeholder="Cree una contraseña segura">
                    
                    <div class="password-requirements">
                        <div class="requirement unmet" id="lengthReq">Al menos 8 caracteres</div>
                        <div class="requirement unmet" id="upperReq">Al menos una letra mayúscula</div>
                        <div class="requirement unmet" id="lowerReq">Al menos una letra minúscula</div>
                        <div class="requirement unmet" id="numberReq">Al menos un número</div>
                        <div class="requirement unmet" id="specialReq">Al menos un símbolo especial</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="confirmPassword">Confirmar Contraseña *</label>
                    <input type="password" id="confirmPassword" required placeholder="Repita su contraseña">
                    <div id="confirmPasswordError" class="error hidden">Las contraseñas no coinciden</div>
                </div>
                
                <button type="submit" id="registerButton" disabled>Registrarse</button>
            </form>
            
            <div class="login-link">
                ¿Ya tienes una cuenta? <a href="#">Iniciar Sesión</a>
            </div>
        </div>
        
        <div id="successMessage" class="success-message hidden">
            <div class="success-icon">✓</div>
            <h2>¡Registro Exitoso!</h2>
            <p>Su cuenta ha sido creada correctamente.</p>
            <p>Será redirigido automáticamente a la página de inicio de sesión.</p>
        </div>
    </div>

    <script>
        // Datos de usuarios (simulando base de datos)
        let users = JSON.parse(localStorage.getItem('conectaBarrioUsers')) || [];
        
        // Elementos del DOM
        const registrationForm = document.getElementById('registrationForm');
        const emailInput = document.getElementById('email');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirmPassword');
        const registerButton = document.getElementById('registerButton');
        const emailError = document.getElementById('emailError');
        const confirmPasswordError = document.getElementById('confirmPasswordError');
        const successMessage = document.getElementById('successMessage');
        const registerForm = document.getElementById('registerForm');
        
        // Requisitos de contraseña
        const lengthReq = document.getElementById('lengthReq');
        const upperReq = document.getElementById('upperReq');
        const lowerReq = document.getElementById('lowerReq');
        const numberReq = document.getElementById('numberReq');
        const specialReq = document.getElementById('specialReq');
        
        // Validar email único
        function validateEmail() {
            const email = emailInput.value;
            if (users.some(user => user.email === email)) {
                emailError.classList.remove('hidden');
                return false;
            } else {
                emailError.classList.add('hidden');
                return true;
            }
        }
        
        // Validar contraseña
        function validatePassword() {
            const password = passwordInput.value;
            let isValid = true;
            
            // Longitud
            if (password.length >= 8) {
                lengthReq.classList.remove('unmet');
                lengthReq.classList.add('met');
            } else {
                lengthReq.classList.remove('met');
                lengthReq.classList.add('unmet');
                isValid = false;
            }
            
            // Mayúscula
            if (/[A-Z]/.test(password)) {
                upperReq.classList.remove('unmet');
                upperReq.classList.add('met');
            } else {
                upperReq.classList.remove('met');
                upperReq.classList.add('unmet');
                isValid = false;
            }
            
            // Minúscula
            if (/[a-z]/.test(password)) {
                lowerReq.classList.remove('unmet');
                lowerReq.classList.add('met');
            } else {
                lowerReq.classList.remove('met');
                lowerReq.classList.add('unmet');
                isValid = false;
            }
            
            // Número
            if (/\d/.test(password)) {
                numberReq.classList.remove('unmet');
                numberReq.classList.add('met');
            } else {
                numberReq.classList.remove('met');
                numberReq.classList.add('unmet');
                isValid = false;
            }
            
            // Símbolo especial
            if (/[!@#$%^&*()_+\-=\[\]{};':"\\|,.<>\/?]/.test(password)) {
                specialReq.classList.remove('unmet');
                specialReq.classList.add('met');
            } else {
                specialReq.classList.remove('met');
                specialReq.classList.add('unmet');
                isValid = false;
            }
            
            return isValid;
        }
        
        // Validar confirmación de contraseña
        function validateConfirmPassword() {
            if (passwordInput.value === confirmPasswordInput.value) {
                confirmPasswordError.classList.add('hidden');
                return true;
            } else {
                confirmPasswordError.classList.remove('hidden');
                return false;
            }
        }
        
        // Habilitar o deshabilitar el botón de registro
        function validateForm() {
            const isEmailValid = validateEmail();
            const isPasswordValid = validatePassword();
            const isConfirmPasswordValid = validateConfirmPassword();
            
            const allFieldsFilled = 
                document.getElementById('profileType').value &&
                document.getElementById('fullName').value &&
                emailInput.value &&
                passwordInput.value &&
                confirmPasswordInput.value;
            
            registerButton.disabled = !(isEmailValid && isPasswordValid && isConfirmPasswordValid && allFieldsFilled);
        }
        
        // Event listeners para validación en tiempo real
        emailInput.addEventListener('input', validateForm);
        passwordInput.addEventListener('input', validateForm);
        confirmPasswordInput.addEventListener('input', validateForm);
        document.getElementById('profileType').addEventListener('change', validateForm);
        document.getElementById('fullName').addEventListener('input', validateForm);
        
        // Manejar envío del formulario
        registrationForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (validateEmail() && validatePassword() && validateConfirmPassword()) {
                // Crear nuevo usuario
                const newUser = {
                    profileType: document.getElementById('profileType').value,
                    fullName: document.getElementById('fullName').value,
                    email: emailInput.value,
                    password: passwordInput.value, // En una app real, esto debería estar encriptado
                    registrationDate: new Date().toISOString()
                };
                
                // Guardar usuario
                users.push(newUser);
                localStorage.setItem('conectaBarrioUsers', JSON.stringify(users));
                
                // Mostrar mensaje de éxito
                registerForm.classList.add('hidden');
                successMessage.classList.remove('hidden');
                
                // Actualizar barra de progreso
                document.querySelectorAll('.progress-step').forEach(step => {
                    step.classList.remove('step-active');
                });
                document.querySelectorAll('.progress-step')[2].classList.add('step-completed');
                
                // Redirigir después de 3 segundos
                setTimeout(() => {
                    // En una aplicación real, aquí redirigiríamos a la página de inicio de sesión
                    alert('Redirigiendo a la página de inicio de sesión...');
                    // window.location.href = 'login.html';
                }, 3000);
            }
        });
        
        // Inicializar validación
        validateForm();
    </script>
</body>
</html>